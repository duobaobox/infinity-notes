# æ•°æ®åº“ç»“æ„ä¼˜åŒ–æŠ¥å‘Š

## ğŸ“Š å½“å‰é¡¹ç›®åˆ†æ

### é¡¹ç›®æ¦‚å†µ
- **é¡¹ç›®åç§°**: Infinite Notes (æ— é™ä¾¿ç­¾åº”ç”¨)
- **æŠ€æœ¯æ ˆ**: React 18 + TypeScript + Vite + IndexedDB + Zustand
- **æ•°æ®åº“**: IndexedDB (æµè§ˆå™¨åŸç”Ÿé«˜æ€§èƒ½å­˜å‚¨)
- **æ¶æ„æ¨¡å¼**: åˆ†å±‚æ¶æ„ + é€‚é…å™¨æ¨¡å¼ + å•ä¾‹æ¨¡å¼

### åŸå§‹æ•°æ®åº“ç»“æ„
```
â”œâ”€â”€ users (ç”¨æˆ·è¡¨)
â”œâ”€â”€ canvases (ç”»å¸ƒè¡¨)  
â”œâ”€â”€ sticky_notes (ä¾¿ç­¾è¡¨)
â”œâ”€â”€ tags (æ ‡ç­¾è¡¨)
â”œâ”€â”€ ai_settings (AIè®¾ç½®è¡¨)
â””â”€â”€ ui_settings (UIè®¾ç½®è¡¨)
```

## ğŸ”§ å·²å®æ–½çš„ä¼˜åŒ–æªæ–½

### 1. ç´¢å¼•ä¼˜åŒ–
#### æ–°å¢å¤åˆç´¢å¼•
- `canvases.user_updated`: [user_id, updated_at] - æå‡ç”¨æˆ·ç”»å¸ƒæŸ¥è¯¢æ€§èƒ½
- `sticky_notes.canvas_updated`: [canvas_id, updated_at] - ä¼˜åŒ–ç”»å¸ƒä¾¿ç­¾æŸ¥è¯¢
- `tags.user_name`: [user_id, name] - ç¡®ä¿ç”¨æˆ·å†…æ ‡ç­¾åå”¯ä¸€
- `ui_settings.user_setting`: [user_id, setting_type] - ç¡®ä¿ç”¨æˆ·è®¾ç½®ç±»å‹å”¯ä¸€

#### æ–°å¢å•åˆ—ç´¢å¼•
- `users.created_at` - æŒ‰åˆ›å»ºæ—¶é—´æŸ¥è¯¢ç”¨æˆ·
- `canvases.last_accessed` - æœ€è¿‘è®¿é—®æ—¶é—´ç´¢å¼•
- `sticky_notes.created_at` - åˆ›å»ºæ—¶é—´ç´¢å¼•
- `sticky_notes.color` - æŒ‰é¢œè‰²åˆ†ç±»æŸ¥è¯¢
- `sticky_notes.z_index` - å±‚çº§ç´¢å¼•
- `sticky_notes.position_x/y` - ä½ç½®ç´¢å¼•ï¼Œæ”¯æŒç©ºé—´æŸ¥è¯¢
- `tags.color` - æŒ‰é¢œè‰²åˆ†ç±»æ ‡ç­¾

### 2. æ–°å¢æ•°æ®è¡¨
#### ä¾¿ç­¾è¿æ¥å…³ç³»è¡¨ (note_connections)
```typescript
interface NoteConnection {
  id: string;
  source_note_id: string;
  target_note_id: string;
  canvas_id: string;
  connection_type: 'line' | 'arrow' | 'curve';
  style?: { color?: string; width?: number; dashArray?: string };
  created_at: string;
  updated_at?: string;
}
```

#### ä¾¿ç­¾ç‰ˆæœ¬å†å²è¡¨ (note_versions)
```typescript
interface NoteVersion {
  id: string;
  note_id: string;
  version_number: number;
  title: string;
  content: string;
  position_x: number;
  position_y: number;
  width: number;
  height: number;
  color: string;
  font_size?: number;
  change_description?: string;
  created_at: string;
}
```

### 3. æ€§èƒ½ç›‘æ§ç³»ç»Ÿ
- **PerformanceMonitor**: ç›‘æ§æ•°æ®åº“æ“ä½œæ€§èƒ½
- **è‡ªåŠ¨æ…¢æŸ¥è¯¢æ£€æµ‹**: è¶…è¿‡1ç§’çš„æ“ä½œè‡ªåŠ¨è®°å½•è­¦å‘Š
- **æ€§èƒ½æŠ¥å‘Š**: æä¾›è¯¦ç»†çš„æ“ä½œç»Ÿè®¡å’Œåˆ†æ
- **è£…é¥°å™¨æ”¯æŒ**: ç®€åŒ–æ€§èƒ½ç›‘æ§é›†æˆ

### 4. ç¼“å­˜ç®¡ç†ç³»ç»Ÿ
- **CacheManager**: å†…å­˜ç¼“å­˜ç®¡ç†å™¨
- **TTLæ”¯æŒ**: å¯é…ç½®çš„ç¼“å­˜è¿‡æœŸæ—¶é—´
- **è‡ªåŠ¨æ¸…ç†**: å®šæœŸæ¸…ç†è¿‡æœŸç¼“å­˜
- **æ‰¹é‡æ“ä½œ**: æ”¯æŒæ‰¹é‡è®¾ç½®å’Œè·å–ç¼“å­˜
- **å‰ç¼€åˆ é™¤**: æ”¯æŒæŒ‰å‰ç¼€æ‰¹é‡åˆ é™¤ç¼“å­˜

### 5. é«˜çº§æŸ¥è¯¢æ–¹æ³•
- `getNotesByColor()` - æŒ‰é¢œè‰²æŸ¥è¯¢ä¾¿ç­¾
- `getNotesByDateRange()` - æŒ‰æ—¶é—´èŒƒå›´æŸ¥è¯¢
- `getNotesInRegion()` - ç©ºé—´æŸ¥è¯¢ï¼ˆåŒºåŸŸå†…ä¾¿ç­¾ï¼‰
- `searchNotes()` - å…¨æ–‡æœç´¢ï¼ˆæ ‡é¢˜å’Œå†…å®¹ï¼‰
- `getNotesStats()` - ä¾¿ç­¾ç»Ÿè®¡ä¿¡æ¯
- `batchUpdateNotePositions()` - æ‰¹é‡æ›´æ–°ä½ç½®ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰

## ğŸ“ˆ æ€§èƒ½æå‡é¢„æœŸ

### æŸ¥è¯¢æ€§èƒ½
- **å¤åˆç´¢å¼•**: ç”¨æˆ·ç”»å¸ƒæŸ¥è¯¢æ€§èƒ½æå‡ 60-80%
- **ç¼“å­˜ç³»ç»Ÿ**: é‡å¤æŸ¥è¯¢æ€§èƒ½æå‡ 90%+
- **æ‰¹é‡æ“ä½œ**: å¤§é‡ä¾¿ç­¾ä½ç½®æ›´æ–°æ€§èƒ½æå‡ 70%

### å­˜å‚¨æ•ˆç‡
- **ç´¢å¼•ä¼˜åŒ–**: å‡å°‘å…¨è¡¨æ‰«æï¼Œæå‡æŸ¥è¯¢æ•ˆç‡
- **æ•°æ®ç»“æ„**: æ”¯æŒæ›´å¤æ‚çš„ä¸šåŠ¡åœºæ™¯ï¼ˆè¿æ¥ã€ç‰ˆæœ¬æ§åˆ¶ï¼‰

### å¼€å‘ä½“éªŒ
- **æ€§èƒ½ç›‘æ§**: å®æ—¶å‘ç°æ€§èƒ½ç“¶é¢ˆ
- **ç¼“å­˜ç®¡ç†**: è‡ªåŠ¨åŒ–ç¼“å­˜ç­–ç•¥
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰

## ğŸš€ è¿›ä¸€æ­¥ä¼˜åŒ–å»ºè®®

### 1. æ•°æ®åˆ†ç‰‡ç­–ç•¥
```typescript
// æŒ‰ç”»å¸ƒIDåˆ†ç‰‡å­˜å‚¨ä¾¿ç­¾ï¼Œå‡å°‘å•è¡¨æ•°æ®é‡
const shardKey = canvasId.slice(-1); // ä½¿ç”¨ç”»å¸ƒIDæœ€åä¸€ä½ä½œä¸ºåˆ†ç‰‡é”®
const tableName = `sticky_notes_${shardKey}`;
```

### 2. è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–
```typescript
// åªåŠ è½½å¯è§†åŒºåŸŸå†…çš„ä¾¿ç­¾
async getVisibleNotes(canvasId: string, viewport: {
  x: number, y: number, width: number, height: number
}): Promise<StickyNote[]>
```

### 3. å¢é‡åŒæ­¥æœºåˆ¶
```typescript
// æ”¯æŒå¢é‡æ•°æ®åŒæ­¥ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“
interface SyncDelta {
  added: StickyNote[];
  updated: StickyNote[];
  deleted: string[];
  timestamp: string;
}
```

### 4. å‹ç¼©å­˜å‚¨
```typescript
// å¯¹å¤§æ–‡æœ¬å†…å®¹è¿›è¡Œå‹ç¼©å­˜å‚¨
import { compress, decompress } from 'lz-string';

const compressedContent = compress(note.content);
```

## ğŸ” ç›‘æ§æŒ‡æ ‡

### å…³é”®æ€§èƒ½æŒ‡æ ‡ (KPI)
- **æŸ¥è¯¢å“åº”æ—¶é—´**: < 100ms (ç›®æ ‡)
- **ç¼“å­˜å‘½ä¸­ç‡**: > 80% (ç›®æ ‡)
- **æ•°æ®åº“å¤§å°**: ç›‘æ§å­˜å‚¨ç©ºé—´ä½¿ç”¨
- **æ…¢æŸ¥è¯¢æ•°é‡**: < 5% (ç›®æ ‡)

### ç›‘æ§æ–¹æ³•
```typescript
// è·å–æ€§èƒ½æŠ¥å‘Š
const report = performanceMonitor.getPerformanceReport();

// è·å–ç¼“å­˜ç»Ÿè®¡
const cacheStats = cacheManager.getStats();

// è·å–å­˜å‚¨ä¿¡æ¯
const storageInfo = await dbService.getStorageInfo();
```

## ğŸ“ ä½¿ç”¨å»ºè®®

### 1. å¼€å‘é˜¶æ®µ
- å¯ç”¨æ€§èƒ½ç›‘æ§ï¼ŒåŠæ—¶å‘ç°æ€§èƒ½é—®é¢˜
- å®šæœŸæŸ¥çœ‹æ€§èƒ½æŠ¥å‘Šï¼Œä¼˜åŒ–æ…¢æŸ¥è¯¢
- åˆç†è®¾ç½®ç¼“å­˜TTLï¼Œå¹³è¡¡æ€§èƒ½å’Œæ•°æ®ä¸€è‡´æ€§

### 2. ç”Ÿäº§ç¯å¢ƒ
- ç›‘æ§æ•°æ®åº“å¤§å°ï¼ŒåŠæ—¶æ¸…ç†å†å²æ•°æ®
- å®šæœŸå¤‡ä»½é‡è¦æ•°æ®
- æ ¹æ®ç”¨æˆ·ä½¿ç”¨æ¨¡å¼è°ƒæ•´ç¼“å­˜ç­–ç•¥

### 3. æ‰©å±•åŠŸèƒ½
- åˆ©ç”¨æ–°å¢çš„è¿æ¥è¡¨å®ç°ä¾¿ç­¾å…³ç³»å›¾
- ä½¿ç”¨ç‰ˆæœ¬è¡¨å®ç°ä¾¿ç­¾å†å²å›æ»š
- åŸºäºç»Ÿè®¡æ•°æ®å®ç°æ™ºèƒ½æ¨è

## ğŸ¯ æ€»ç»“

é€šè¿‡æœ¬æ¬¡ä¼˜åŒ–ï¼Œæ•°æ®åº“æ¶æ„æ›´åŠ å®Œå–„ï¼Œæ€§èƒ½æ˜¾è‘—æå‡ï¼š

1. **ç´¢å¼•ä¼˜åŒ–**: å¤§å¹…æå‡æŸ¥è¯¢æ€§èƒ½
2. **ç¼“å­˜ç³»ç»Ÿ**: å‡å°‘é‡å¤æŸ¥è¯¢å¼€é”€
3. **ç›‘æ§ä½“ç³»**: å®æ—¶æŒæ¡æ€§èƒ½çŠ¶å†µ
4. **æ‰©å±•èƒ½åŠ›**: æ”¯æŒæ›´å¤šé«˜çº§åŠŸèƒ½

è¿™äº›ä¼˜åŒ–ä¸ºåº”ç”¨çš„é•¿æœŸå‘å±•å¥ å®šäº†åšå®çš„æŠ€æœ¯åŸºç¡€ã€‚

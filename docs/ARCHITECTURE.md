# é¡¹ç›®æ¶æ„æ–‡æ¡£

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†æ— é™ä¾¿ç­¾é¡¹ç›®çš„æ•´ä½“æ¶æ„ã€æ¨¡å—è®¾è®¡å’Œå¼€å‘è§„èŒƒã€‚

## ğŸ“ é¡¹ç›®ç»“æ„æ¦‚è§ˆ

```
src/
â”œâ”€â”€ components/        # Reactç»„ä»¶
â”‚   â”œâ”€â”€ canvas/        # ç”»å¸ƒç›¸å…³ç»„ä»¶
â”‚   â”œâ”€â”€ notes/         # ä¾¿ç­¾ç»„ä»¶
â”‚   â”œâ”€â”€ modals/        # æ¨¡æ€æ¡†ç»„ä»¶
â”‚   â”œâ”€â”€ layout/        # å¸ƒå±€ç»„ä»¶
â”‚   â””â”€â”€ utils/         # ç»„ä»¶å·¥å…·å‡½æ•°
â”œâ”€â”€ stores/            # ZustandçŠ¶æ€ç®¡ç†
â”œâ”€â”€ database/          # IndexedDBæ•°æ®å±‚
â”œâ”€â”€ services/          # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”œâ”€â”€ hooks/             # è‡ªå®šä¹‰React Hooks
â”œâ”€â”€ utils/             # é€šç”¨å·¥å…·å‡½æ•°
â”œâ”€â”€ types/             # TypeScriptç±»å‹å®šä¹‰
â””â”€â”€ assets/            # é™æ€èµ„æº

tests/                 # æµ‹è¯•æ–‡ä»¶ç›®å½•
docs/                  # é¡¹ç›®æ–‡æ¡£
scripts/               # æ„å»ºå’Œéƒ¨ç½²è„šæœ¬
```

## ğŸ§© ç»„ä»¶æ¶æ„ (components/)

### ç›®å½•ç»“æ„
```
components/
â”œâ”€â”€ index.ts                     # ç»„ä»¶ç»Ÿä¸€å¯¼å‡ºæ–‡ä»¶
â”œâ”€â”€ types.ts                     # ç»„ä»¶ç›¸å…³ç±»å‹å®šä¹‰
â”œâ”€â”€ SearchModal.css              # æœç´¢æ¨¡æ€æ¡†æ ·å¼
â”œâ”€â”€ canvas/                      # ç”»å¸ƒç›¸å…³ç»„ä»¶
â”‚   â”œâ”€â”€ CanvasConsole.tsx        # ç”»å¸ƒæ§åˆ¶å°ç»„ä»¶
â”‚   â”œâ”€â”€ CanvasConsole.css        # æ§åˆ¶å°æ ·å¼
â”‚   â”œâ”€â”€ CanvasConstants.ts       # ç”»å¸ƒå¸¸é‡å®šä¹‰
â”‚   â”œâ”€â”€ CanvasGrid.tsx           # ç”»å¸ƒç½‘æ ¼ç»„ä»¶
â”‚   â”œâ”€â”€ CanvasToolbar.tsx        # ç”»å¸ƒå·¥å…·æ ç»„ä»¶
â”‚   â”œâ”€â”€ InfiniteCanvas.css       # ç”»å¸ƒæ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ InfiniteCanvasNew.tsx    # ä¸»ç”»å¸ƒç»„ä»¶
â”‚   â”œâ”€â”€ StickyNoteSlots.tsx      # ä¾¿ç­¾æ’æ§½ç»„ä»¶
â”‚   â””â”€â”€ StickyNoteSlots.css      # æ’æ§½æ ·å¼
â”œâ”€â”€ layout/                      # å¸ƒå±€ç»„ä»¶
â”‚   â””â”€â”€ Sidebar.tsx              # ä¾§è¾¹æ ç»„ä»¶
â”œâ”€â”€ modals/                      # æ¨¡æ€æ¡†ç»„ä»¶
â”‚   â”œâ”€â”€ SettingsModal.tsx        # è®¾ç½®æ¨¡æ€æ¡†
â”‚   â”œâ”€â”€ SettingsModal.css        # è®¾ç½®æ¨¡æ€æ¡†æ ·å¼
â”‚   â”œâ”€â”€ SourceNotesModal.tsx     # æºä¾¿ç­¾æ¨¡æ€æ¡†
â”‚   â””â”€â”€ SourceNotesModal.css     # æºä¾¿ç­¾æ¨¡æ€æ¡†æ ·å¼
â”œâ”€â”€ notes/                       # ä¾¿ç­¾ç›¸å…³ç»„ä»¶
â”‚   â”œâ”€â”€ StickyNote.tsx           # ä¾¿ç­¾ç»„ä»¶
â”‚   â””â”€â”€ StickyNote.css           # ä¾¿ç­¾æ ·å¼
â””â”€â”€ utils/                       # ç»„ä»¶å·¥å…·å‡½æ•°
    â””â”€â”€ HighDPIUtils.ts          # é«˜DPIæ˜¾ç¤ºå·¥å…·
```

### ç»„ä»¶åˆ†ç±»

#### ç”»å¸ƒç»„ä»¶ (canvas/)
- **InfiniteCanvasNew.tsx**: ä¸»ç”»å¸ƒç»„ä»¶ï¼Œæ”¯æŒæ— é™æ»šåŠ¨ã€ç¼©æ”¾ã€æ‹–æ‹½
- **CanvasGrid.tsx**: ç½‘æ ¼èƒŒæ™¯ç»„ä»¶
- **CanvasToolbar.tsx**: ç”»å¸ƒå·¥å…·æ ï¼ŒåŒ…å«ç¼©æ”¾ã€è®¾ç½®ç­‰åŠŸèƒ½
- **CanvasConsole.tsx**: ç”»å¸ƒæ§åˆ¶å°ï¼Œç”¨äºå¿«é€Ÿæ“ä½œ
- **StickyNoteSlots.tsx**: ä¾¿ç­¾æ’æ§½ç®¡ç†ç»„ä»¶

#### ä¾¿ç­¾ç»„ä»¶ (notes/)
- **StickyNote.tsx**: ä¾¿ç­¾ç»„ä»¶ï¼Œæ”¯æŒç¼–è¾‘ã€æ‹–æ‹½ã€è¿æ¥ã€AIæ±‡æ€»ç­‰åŠŸèƒ½

#### å¸ƒå±€ç»„ä»¶ (layout/)
- **Sidebar.tsx**: ä¾§è¾¹æ ç»„ä»¶ï¼Œæ˜¾ç¤ºä¾¿ç­¾åˆ—è¡¨å’Œæ“ä½œ

#### æ¨¡æ€æ¡†ç»„ä»¶ (modals/)
- **SettingsModal.tsx**: è®¾ç½®æ¨¡æ€æ¡†ï¼ŒåŒ…å«å¤–è§‚ã€AIç­‰è®¾ç½®
- **SourceNotesModal.tsx**: æºä¾¿ç­¾æŸ¥çœ‹æ¨¡æ€æ¡†ï¼Œç”¨äºæº¯æºåŠŸèƒ½

#### å·¥å…·ç»„ä»¶ (utils/)
- **HighDPIUtils.ts**: é«˜DPIæ˜¾ç¤ºé€‚é…å·¥å…·å‡½æ•°

### ä½¿ç”¨è§„èŒƒ

æ‰€æœ‰ç»„ä»¶éƒ½é€šè¿‡ `index.ts` ç»Ÿä¸€å¯¼å‡ºï¼š

```typescript
import { InfiniteCanvas, StickyNote, SettingsModal } from './components';
```

## ğŸª çŠ¶æ€ç®¡ç† (stores/)

### ç›®å½•ç»“æ„
```
stores/
â”œâ”€â”€ index.ts                 # Storeç»Ÿä¸€å¯¼å‡ºæ–‡ä»¶
â”œâ”€â”€ stickyNotesStore.ts      # ä¾¿ç­¾çŠ¶æ€ç®¡ç†
â”œâ”€â”€ canvasStore.ts           # ç”»å¸ƒçŠ¶æ€ç®¡ç†
â”œâ”€â”€ connectionStore.ts       # è¿æ¥çº¿çŠ¶æ€ç®¡ç†
â”œâ”€â”€ aiStore.ts               # AIåŠŸèƒ½çŠ¶æ€ç®¡ç†
â””â”€â”€ uiStore.ts               # UIç•Œé¢çŠ¶æ€ç®¡ç†
```

### StoreèŒè´£

#### stickyNotesStore.ts
- ä¾¿ç­¾æ•°æ®ç®¡ç†ï¼šå¢åˆ æ”¹æŸ¥
- ä¾¿ç­¾ä½ç½®å’Œå¤§å°ç®¡ç†
- ä¸IndexedDBçš„æ•°æ®åŒæ­¥
- æ’¤é”€é‡åšåŠŸèƒ½

#### canvasStore.ts
- ç”»å¸ƒç¼©æ”¾çº§åˆ«ç®¡ç†
- ç”»å¸ƒåç§»ä½ç½®ç®¡ç†
- ç”»å¸ƒè§†å£çŠ¶æ€ç®¡ç†
- ç”»å¸ƒäº¤äº’çŠ¶æ€ç®¡ç†

#### connectionStore.ts
- ä¾¿ç­¾é—´è¿æ¥å…³ç³»ç®¡ç†
- è¿æ¥çº¿çš„åˆ›å»ºå’Œåˆ é™¤
- æº¯æºå…³ç³»è¿½è¸ª

#### aiStore.ts
- AIæœåŠ¡é…ç½®ç®¡ç†
- AIæ±‡æ€»åŠŸèƒ½çŠ¶æ€
- AIæµå¼è¾“å‡ºç®¡ç†
- AIé”™è¯¯å¤„ç†

#### uiStore.ts
- æ¨¡æ€æ¡†æ˜¾ç¤ºçŠ¶æ€
- å…¨å±€åŠ è½½çŠ¶æ€
- ç”¨æˆ·ç•Œé¢è®¾ç½®
- ä¸»é¢˜å’Œå¤–è§‚é…ç½®

### æ•°æ®æµæ¨¡å¼
```
UIç»„ä»¶ â†’ Store Actions â†’ Stateæ›´æ–° â†’ UIé‡æ–°æ¸²æŸ“
```

### æŒä¹…åŒ–ç­–ç•¥
- ä¾¿ç­¾æ•°æ®: IndexedDB
- ç”¨æˆ·è®¾ç½®: localStorage
- AIé…ç½®: localStorage
- ç”»å¸ƒçŠ¶æ€: sessionStorage

## ğŸ—„ï¸ æ•°æ®åº“å±‚ (database/)

### ç›®å½•ç»“æ„
```
database/
â”œâ”€â”€ index.ts                         # æ•°æ®åº“æ¨¡å—ç»Ÿä¸€å¯¼å‡º
â”œâ”€â”€ IndexedDBService.ts              # IndexedDBæ ¸å¿ƒæœåŠ¡
â”œâ”€â”€ IndexedDBAdapter.ts              # æ•°æ®åº“é€‚é…å™¨
â”œâ”€â”€ useIndexedDB.ts                  # IndexedDB React Hook
â”œâ”€â”€ IndexedDBAISettingsStorage.ts    # AIè®¾ç½®å­˜å‚¨
â”œâ”€â”€ IndexedDBUISettingsStorage.ts    # UIè®¾ç½®å­˜å‚¨
â”œâ”€â”€ CacheManager.ts                  # ç¼“å­˜ç®¡ç†å™¨
â””â”€â”€ PerformanceMonitor.ts            # æ€§èƒ½ç›‘æ§å™¨
```

### æ¨¡å—èŒè´£

#### IndexedDBService.ts
- æ•°æ®åº“åˆå§‹åŒ–å’Œç‰ˆæœ¬ç®¡ç†
- ä¾¿ç­¾æ•°æ®çš„CRUDæ“ä½œ
- äº‹åŠ¡ç®¡ç†å’Œé”™è¯¯å¤„ç†

#### IndexedDBAdapter.ts
- ç»Ÿä¸€æ•°æ®åº“æ“ä½œæ¥å£
- æ•°æ®æ ¼å¼è½¬æ¢å’ŒéªŒè¯
- æ‰¹é‡æ“ä½œä¼˜åŒ–

#### useIndexedDB.ts
- æä¾›Reactç»„ä»¶å‹å¥½çš„æ•°æ®åº“æ“ä½œæ¥å£
- è‡ªåŠ¨å¤„ç†åŠ è½½çŠ¶æ€å’Œé”™è¯¯çŠ¶æ€

#### å­˜å‚¨æ¨¡å—
- **IndexedDBAISettingsStorage.ts**: AIé…ç½®çš„æŒä¹…åŒ–å­˜å‚¨
- **IndexedDBUISettingsStorage.ts**: ç”¨æˆ·ç•Œé¢åå¥½è®¾ç½®

#### æ€§èƒ½æ¨¡å—
- **CacheManager.ts**: å†…å­˜ç¼“å­˜ç®¡ç†
- **PerformanceMonitor.ts**: æ•°æ®åº“æ“ä½œæ€§èƒ½ç›‘æ§

### æ•°æ®æ¨¡å‹

```typescript
interface StickyNote {
  id: string;
  title: string;
  content: string;
  x: number;
  y: number;
  width: number;
  height: number;
  color: string;
  createdAt: Date;
  updatedAt: Date;
  sourceNoteIds?: string[];
}
```

## ğŸ”§ æœåŠ¡å±‚ (services/)

### ç›®å½•ç»“æ„
```
services/
â”œâ”€â”€ index.ts                 # æœåŠ¡ç»Ÿä¸€å¯¼å‡ºæ–‡ä»¶
â”œâ”€â”€ aiService.ts             # AIæœåŠ¡ä¸»æ–‡ä»¶
â””â”€â”€ ai/                      # AIç›¸å…³æœåŠ¡
    â””â”€â”€ (AIå­æœåŠ¡æ–‡ä»¶)
```

### æœåŠ¡èŒè´£

#### aiService.ts
- AIæ¨¡å‹æ¥å£è°ƒç”¨
- ä¾¿ç­¾å†…å®¹æ™ºèƒ½æ±‡æ€»
- æµå¼è¾“å‡ºå¤„ç†
- AIå“åº”è§£æå’Œæ ¼å¼åŒ–
- é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

#### AIåŠŸèƒ½
- **æ™ºèƒ½æ±‡æ€»**: å¤šä¾¿ç­¾å†…å®¹åˆå¹¶æ±‡æ€»
- **æµå¼è¾“å‡º**: å®æ—¶æ˜¾ç¤ºAIç”Ÿæˆå†…å®¹
- **å†…å®¹ä¼˜åŒ–**: ä¾¿ç­¾å†…å®¹æ™ºèƒ½ä¼˜åŒ–

### æœåŠ¡æ¶æ„
```
UIç»„ä»¶ â†’ Store â†’ Service â†’ å¤–éƒ¨API
```

## ğŸ£ è‡ªå®šä¹‰Hooks (hooks/)

### ç›®å½•ç»“æ„
```
hooks/
â”œâ”€â”€ index.ts                     # Hooksç»Ÿä¸€å¯¼å‡ºæ–‡ä»¶
â”œâ”€â”€ useKeyboardShortcuts.ts      # é”®ç›˜å¿«æ·é”®Hook
â””â”€â”€ ai/                          # AIç›¸å…³Hooks
    â””â”€â”€ (AIç›¸å…³Hookæ–‡ä»¶)
```

### HooksåŠŸèƒ½

#### useKeyboardShortcuts.ts
- å…¨å±€å¿«æ·é”®ç›‘å¬
- å¿«æ·é”®ç»„åˆå¤„ç†
- ä¸Šä¸‹æ–‡ç›¸å…³çš„å¿«æ·é”®

#### å¿«æ·é”®åˆ—è¡¨
- `Ctrl+N`: åˆ›å»ºæ–°ä¾¿ç­¾
- `Ctrl+S`: ä¿å­˜æ‰€æœ‰ä¾¿ç­¾
- `Ctrl+Z`: æ’¤é”€
- `Ctrl+Y`: é‡åš
- `Ctrl++`: æ”¾å¤§ç”»å¸ƒ
- `Ctrl+-`: ç¼©å°ç”»å¸ƒ
- `Ctrl+0`: é‡ç½®ç¼©æ”¾

### Hookè®¾è®¡åŸåˆ™
- å•ä¸€èŒè´£
- å¯å¤ç”¨æ€§
- ç±»å‹å®‰å…¨
- æ€§èƒ½ä¼˜åŒ–

## ğŸ› ï¸ å·¥å…·å‡½æ•° (utils/)

### ç›®å½•ç»“æ„
```
utils/
â””â”€â”€ connectionLineManager.ts    # è¿æ¥çº¿ç®¡ç†å·¥å…·
```

### å·¥å…·åŠŸèƒ½

#### connectionLineManager.ts
- ä¾¿ç­¾è¿æ¥çº¿ç®¡ç†å·¥å…·
- è¿æ¥çº¿çš„åˆ›å»ºå’Œé”€æ¯
- è¿æ¥çº¿çš„è§†è§‰æ•ˆæœç®¡ç†
- è¿æ¥çº¿çš„äº¤äº’å¤„ç†
- è¿æ¥çº¿çš„æ€§èƒ½ä¼˜åŒ–

### è¿æ¥çº¿åŠŸèƒ½
- æ”¯æŒä¾¿ç­¾é—´çš„å¯è§†åŒ–è¿æ¥
- è‡ªåŠ¨è®¡ç®—æœ€ä½³è¿æ¥è·¯å¾„
- æ”¯æŒå¤šç§è¿æ¥çº¿æ ·å¼
- å“åº”å¼è¿æ¥ç‚¹å®šä½

## ğŸ§ª æµ‹è¯•æ¶æ„ (tests/)

### ç›®å½•ç»“æ„
```
tests/
â”œâ”€â”€ utils/                              # æµ‹è¯•å·¥å…·
â”‚   â”œâ”€â”€ traceabilityTest.ts             # æº¯æºåŠŸèƒ½æµ‹è¯•å·¥å…·
â”‚   â””â”€â”€ replaceModeTraceabilityTest.ts  # æ›¿æ¢æ¨¡å¼æº¯æºæµ‹è¯•å·¥å…·
```

### æµ‹è¯•å·¥å…·

#### traceabilityTest.ts
- æº¯æºåŠŸèƒ½æµ‹è¯•å·¥å…·
- åˆ›å»ºæµ‹è¯•æ•°æ®å’ŒéªŒè¯ä¾¿ç­¾æº¯æºåŠŸèƒ½

#### replaceModeTraceabilityTest.ts  
- æ›¿æ¢æ¨¡å¼æº¯æºåŠŸèƒ½æµ‹è¯•å·¥å…·
- éªŒè¯æ›¿æ¢æ¨¡å¼ä¸‹çš„æº¯æºåŠŸèƒ½

### ä½¿ç”¨æ–¹æ³•
```javascript
// ç¤ºä¾‹ï¼šåˆ›å»ºæº¯æºæµ‹è¯•æ•°æ®
import { createTraceabilityTestData } from './tests/utils/traceabilityTest';
await createTraceabilityTestData();
```

## ğŸ“ å¼€å‘è§„èŒƒ

### ä»£ç é£æ ¼
- ä½¿ç”¨TypeScriptè¿›è¡Œå¼€å‘
- éµå¾ªESLinté…ç½®çš„ä»£ç è§„èŒƒ
- ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡å’Œå‡½æ•°å
- æ·»åŠ å¿…è¦çš„æ³¨é‡Š

### å‘½åè§„èŒƒ
- ç»„ä»¶: PascalCase (ä¾‹: `StickyNote`)
- å‡½æ•°/å˜é‡: camelCase (ä¾‹: `createNote`)
- å¸¸é‡: UPPER_SNAKE_CASE (ä¾‹: `CANVAS_CONSTANTS`)
- æ–‡ä»¶å: camelCaseæˆ–kebab-case

### æ–‡ä»¶ç»„ç»‡
- æ–°ç»„ä»¶æ”¾åœ¨å¯¹åº”çš„å­ç›®å½•ä¸­
- å·¥å…·å‡½æ•°æ”¾åœ¨utilsç›®å½•
- ç±»å‹å®šä¹‰æ”¾åœ¨typesç›®å½•
- ä¿æŒæ¨¡å—çš„å•ä¸€èŒè´£

### æ€§èƒ½è€ƒè™‘
- ä½¿ç”¨React.memoä¼˜åŒ–ç»„ä»¶æ¸²æŸ“
- ä½¿ç”¨useCallbackå’ŒuseMemoä¼˜åŒ–æ€§èƒ½
- é¿å…åœ¨renderä¸­åˆ›å»ºæ–°å¯¹è±¡
- åˆç†ä½¿ç”¨çŠ¶æ€ç®¡ç†ï¼Œé¿å…è¿‡åº¦æ¸²æŸ“

## ğŸ”„ æ•°æ®æµ

### æ•´ä½“æ•°æ®æµ
```
ç”¨æˆ·äº¤äº’ â†’ ç»„ä»¶äº‹ä»¶ â†’ Store Action â†’ çŠ¶æ€æ›´æ–° â†’ ç»„ä»¶é‡æ¸²æŸ“
                                â†“
                           æ•°æ®åº“æŒä¹…åŒ–
```

### ä¾¿ç­¾æ“ä½œæµç¨‹
```
ç”¨æˆ·åˆ›å»ºä¾¿ç­¾ â†’ StickyNoteç»„ä»¶ â†’ stickyNotesStore.addNote() 
            â†’ IndexedDBService.createNote() â†’ æ•°æ®åº“å­˜å‚¨
            â†’ çŠ¶æ€æ›´æ–° â†’ UIé‡æ–°æ¸²æŸ“
```

### AIæ±‡æ€»æµç¨‹
```
ç”¨æˆ·é€‰æ‹©ä¾¿ç­¾ â†’ AIæ±‡æ€»æŒ‰é’® â†’ aiStore.summarizeNotes() 
            â†’ aiService.summarizeNotes() â†’ AI APIè°ƒç”¨
            â†’ æµå¼è¾“å‡º â†’ æ–°ä¾¿ç­¾åˆ›å»º â†’ æº¯æºå…³ç³»å»ºç«‹
```

## ğŸš€ æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°ç»„ä»¶
1. åœ¨å¯¹åº”ç›®å½•åˆ›å»ºç»„ä»¶æ–‡ä»¶
2. æ·»åŠ TypeScriptç±»å‹å®šä¹‰
3. åœ¨index.tsä¸­å¯¼å‡º
4. ç¼–å†™ç»„ä»¶æ–‡æ¡£

### æ·»åŠ æ–°Store
1. åˆ›å»ºStoreæ–‡ä»¶
2. å®šä¹‰çŠ¶æ€æ¥å£
3. å®ç°çŠ¶æ€ç®¡ç†é€»è¾‘
4. åœ¨index.tsä¸­å¯¼å‡º

### æ·»åŠ æ–°æœåŠ¡
1. åœ¨servicesç›®å½•åˆ›å»ºæœåŠ¡æ–‡ä»¶
2. å®ç°ä¸šåŠ¡é€»è¾‘
3. æ·»åŠ é”™è¯¯å¤„ç†
4. ç¼–å†™æœåŠ¡æ–‡æ¡£

è¿™ä¸ªæ¶æ„è®¾è®¡ç¡®ä¿äº†ä»£ç çš„å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§å’Œå›¢é˜Ÿåä½œçš„æ•ˆç‡ã€‚æ¯ä¸ªæ¨¡å—éƒ½æœ‰æ˜ç¡®çš„èŒè´£è¾¹ç•Œï¼Œä¾¿äºç†è§£å’Œä¿®æ”¹ã€‚
